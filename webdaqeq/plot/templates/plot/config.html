<!DOCTYPE html>
<html lang="es">
  {% extends 'plot/home.html' %}
  {% load bootstrap3 %}
  {% load staticfiles %}

  {% block meta %}
    <meta charset="utf-8">
    <script src="{% static "plot/js/jquery-1.12.3.min.js" %}"></script>
    <script src="{% static "plot/js/djangoAjax.js" %}"></script>
    <script src="{% static "plot/js/config.js" %}"></script>
  <style type="text/css">

    .icon-input-btn{

        display: inline-block;
        position: relative;
    }

    .icon-input-btn .glyphicon{

        display: inline-block;
        position: absolute;
        left: 0.35em;
        top: 30%;
    }
    </style>
  {% endblock %}

  {% block title %}
    {{page_title}}
  {% endblock %}

  {% block content %}
  {% if user.is_authenticated %}
    {% if action_text == "Guardar" %}
    <form role="form" id="config_form" action="/plot/verify_config/" name="verify" method="post" enctype="multipart/form-data" class="form-horizontal col-md-12">
      <div class="row">
        <div class="form-group col-sm-5">
          {% csrf_token %}
          {% bootstrap_form form layout='horizontal' %}
        </div>

        <div class="col-xs-5 col-xs-offset-1">
          {% if this_url == "/plot/config/" %}
          <h4>Sensores detectados</h4>
          <div class="col-xs-12">
            <table id="sensor_table" class="table-condensed">
              <tr>
                <th class="col-xs-1">N째 de serie</th>
                <th class="col-xs-1">Posici처n</th>
                <th class="col-xs-1">Detrend</th>
                <th class="col-xs-3">Trigger Soft (x,y,z):</th>
                <th class="col-xs-3">Detrigger (x,y,z):</th>
                <th class="col-xs-2">Votos (x,y,z):</th>
                <th class="col-xs-1">Trigger Hard (x,y,z):</th>
              </tr>
              <tr>
                <td class="col-xs-1">
                <td class="col-xs-1">
                <td class="col-xs-1">
                <td class="col-xs-3">
                  <input type="number" id="id_triggerXYZ" name="triggerXYZ" min=0.01 step=0.001 value=0.01>
                  <input type="button" id="id_setTrigger" name="setTrigger" value="Set" onclick="triggerSet()">
                <td class="col-xs-3">
                  <input type="number" id="id_detriggerXYZ" name="detriggerXYZ" min=0.01 step=0.001 value=0.01>
                  <input type="button" id="id_setDetrigger" name="setDetrigger" value="Set" onclick="detriggerSet()">
                <td class="col-xs-2">
                  <input type="number" id="id_votesXYZ" name="votesXYZ" min=0 value=1>
                  <input type="button" id="id_setVotes" name="setVotes" value="Set" onclick="votesSet()">
                <td class="col-xs-1">
                    <input type="number" id="id_secondTriggerXYZ" name="secondTriggerXYZ" min=0.01 step=0.001 value=0.01>
                    <input type="button" id="id_setSecondTrigger" name="setSecondTrigger" value="Set" onclick="secondTriggerSet()">
              </tr>
            {% for sensor in sensors %}
              <script>
                sensorNums.push('{{sensor.0}}')
              </script>
              <tr>
                <input type="hidden" name="isRed{{sensor.0}}" value={% if sensor.16 == "1" %}"true"{% else %}"false"{% endif %}>
                <td class="col-xs-1">
                  <label class="checkbox-inline">
                  <input type="checkbox" name="check{{sensor.0}}" {% if sensor.15 == "1" %}checked="checked"{% endif %} onchange="verify_required_position(this)">
                  <input type="text" name="serialNum" {% if sensor.16 == "1" %}class="text-danger"{% endif %} readonly="true" value="{{sensor.0}}">
                <td class="col-xs-1">
                  <input type="text" {% if sensor.16 == "1" %}class="text-danger"{% endif %} name="position" data-checkboxName="from-check{{sensor.0}}" {% if sensor.15 == "1" %}required{% endif %} value="{{sensor.1}}">
                <td class="col-xs-1"><input type="number" min=0 name="detrend" value={{sensor.8}}>
                <td class="col-xs-3">
                  <input type="number" class="trigger-input" name="triggerX" min=0.01 step=0.001 value={{sensor.2}}>
                  <input type="number" class="trigger-input" name="triggerY" min=0.01 step=0.001 value={{sensor.3}}>
                  <input type="number" class="trigger-input" name="triggerZ" min=0.01 step=0.001 value={{sensor.4}}>
                <td class="col-xs-3">
                  <input type="number" class="detrigger-input" name="detriggerX" min=0.01 step=0.001 value={{sensor.5}}>
                  <input type="number" class="detrigger-input" name="detriggerY" min=0.01 step=0.001 value={{sensor.6}}>
                  <input type="number" class="detrigger-input" name="detriggerZ" min=0.01 step=0.001 value={{sensor.7}}>
                <td class="col-xs-2">
                  <input type="number" class="votes-input" name="votesX" min=0 value={{sensor.9}}>
                  <input type="number" class="votes-input" name="votesY" min=0 value={{sensor.10}}>
                  <input type="number" class="votes-input" name="votesZ" min=0 value={{sensor.11}}>

                <td class="col-xs-1">
                  <input type="number" class="secondtrigger-input" name="secondTriggerX" min=0.01 step=0.001 value={{sensor.12}}>
                  <input type="number" class="secondtrigger-input" name="secondTriggerY" min=0.01 step=0.001 value={{sensor.13}}>
                  <input type="number" class="secondtrigger-input" name="secondTriggerZ" min=0.01 step=0.001 value={{sensor.14}}>
              </tr>

            {% endfor %}
            </table>
          </div>
          <div>
            <h4>Agregar Manualmente</h4>
            <input type="text" name="new_sensor">
            <input type="button" value="Agregar serie" onclick="addSerial()">
            <button type="button" class="btn btn-default" onclick="refreshSerial(this);">
              <span class="glyphicon glyphicon-refresh"></span>
            </button>
          </div>
          {% endif %}
        </div>
      </div>
      <button type="submit" name="action" class="btn btn-default col-md-1" value="{{action_text}}">
        <span class="glyphicon glyphicon-floppy-disk submit-span" aria-hidden="true"></span> {{action_text}}
      </button>
      {% buttons reset="Cancelar" layout='vertical' %}{% endbuttons %}
      <input type="hidden" name="this_url" value="{{this_url}}">
    </form>
    {% else %}
      <form role="form" method="post" action="/plot/signal/">
        {% csrf_token %}
        <div class="row">
          <button type="submit" name="action" class="btn btn-default col-md-1" value="{{action_text}}" onclick="disable_submit_span()">
            <span class="glyphicon glyphicon-stop submit-span" aria-hidden="true"></span> {{action_text}}
          </button>
          <input type="hidden" name="is_stopping" value="true">
          <input type="hidden" name="this_url" value="{{this_url}}">
        </div>
      </form>
      <br>
      <p id='config_status_msg'>Para hacer cambios, debe detener la aplicaci처n primero.</p>
    {% endif %}
  {% else %}
  Requiere iniciar sesi처n
  {% endif %}
{% endblock %}
</html>
